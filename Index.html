<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Digify</title>

<!-- Firebase SDK -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
  import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

  // ------------------------------
  // üîπ Replace these with your Firebase project values
  const firebaseConfig = {
    apiKey: "AIzaSyCWK_LC-2leQsuytqvip3WlnqwM2wWvPUM",
      authDomain: "digify-e3066.firebasestorage.app",
      projectId: "digify-e3066",
      storageBucket: "digify-e3066.firebasestorage.app",
      messagingSenderId: "114814654456",
      appId: "1:114814654456:web:93017bd5d4a39c770a280d"
  };
  // ------------------------------

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // ------------------------------
  // üîπ Replace this with your admin email
  const ADMIN_EMAIL = "mopicsgiggs@gmail.com"; // ‚Üê YOU become admin
  // ------------------------------

  window.firebaseData = { auth, db, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut, collection, addDoc, serverTimestamp, ADMIN_EMAIL };
</script>

<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #0b0f1a;
    color: #fff;
  }
  h1,h2 { text-align:center; }
  .container {
    max-width: 400px;
    margin: 50px auto;
    background: #151a2d;
    padding: 25px;
    border-radius: 16px;
    box-shadow: 0 0 30px rgba(90,90,255,.2);
  }
  input, button { width: 100%; padding:12px; margin-top:10px; border-radius:10px; border:none; }
  input { background:#22285a; color:#fff; }
  button { background:#5a5aff; color:#fff; font-weight:bold; cursor:pointer; }
  button.secondary { background:#333355; }
  .hidden { display:none; }
  #status,#uploadStatus { text-align:center; margin-top:10px; font-size:14px; min-height:18px; }
</style>
</head>

<body>

<h1>Digify</h1>

<!-- AUTH CONTAINER -->
<div class="container" id="authBox">
  <h2 id="authTitle">Create Account</h2>
  <input id="email" type="email" placeholder="Email" />
  <input id="password" type="password" placeholder="Password (min 6 chars)" />
  <button id="signupBtn">Sign Up</button>
  <button id="loginBtn" class="secondary">Login</button>
  <p id="status"></p>
</div>

<!-- APP CONTAINER -->
<div class="container hidden" id="appBox">
  <h2>Upload Asset</h2>
  <input type="file" id="fileInput" />
  <button id="uploadBtn">Upload to Cloudinary</button>
  <p id="uploadStatus"></p>
</div>

<script type="module">
const { auth, db, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut, collection, addDoc, serverTimestamp, ADMIN_EMAIL } = window.firebaseData;

const email = document.getElementById("email");
const password = document.getElementById("password");
const status = document.getElementById("status");

document.getElementById("signupBtn").onclick = async () => {
  try {
    await createUserWithEmailAndPassword(auth, email.value, password.value);
    status.textContent = "Account created ‚úÖ";
  } catch (e) { status.textContent = e.message; }
};

document.getElementById("loginBtn").onclick = async () => {
  try {
    await signInWithEmailAndPassword(auth, email.value, password.value);
    status.textContent = "Logged in ‚úÖ";
  } catch (e) { status.textContent = e.message; }
};

onAuthStateChanged(auth, user => {
  if(user){
    document.getElementById("authBox").classList.add("hidden");
    document.getElementById("appBox").classList.remove("hidden");

    // Admin check
    if(user.email === ADMIN_EMAIL){
      document.body.insertAdjacentHTML("beforeend", `
        <div class="container">
          <h2>Admin Panel</h2>
          <p>Welcome Admin üëë</p>
        </div>
      `);
    }
  }
});

// ------------------------------
// üîπ CLOUDINARY CONFIG
// Replace with your Cloud name and Upload preset
const CLOUD_NAME = "dysdgrcsv"; // Cloudinary cloud name
const UPLOAD_PRESET = "digify_upload"; // Unsigned preset
// ------------------------------

document.getElementById("uploadBtn").onclick = async () => {
  const file = document.getElementById("fileInput").files[0];
  if(!file) return;

  const formData = new FormData();
  formData.append("file", file);
  formData.append("upload_preset", UPLOAD_PRESET);

  try{
    const res = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`, {
      method: "POST",
      body: formData
    });

    const data = await res.json();

    // Save URL to Firestore
    await addDoc(collection(db,"assets"),{
      url: data.secure_url,
      user: auth.currentUser.email,
      createdAt: serverTimestamp()
    });

    document.getElementById("uploadStatus").textContent = "Uploaded & saved ‚úÖ";

  }catch(err){
    document.getElementById("uploadStatus").textContent = "Upload failed ‚ùå";
    console.error(err);
  }
};
</script>

</body>
  </html>
